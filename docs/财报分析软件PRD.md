# 财报分析软件产品需求文档 (PRD)

## 1. 产品概述

### 1.1 产品背景
随着企业规模的扩大和财务数据的日益复杂，财报分析成为企业决策的重要依据。传统的财报分析需要人工从PDF文件中提取数据，然后进行计算和分析，过程繁琐且容易出错。为了解决这一问题，我们计划开发一款基于大模型算力的财报分析桌面端软件，实现自动化的数据精确提取、流式计算和智能报告生成，以极佳的本地客户端体验提升分析效率和准确性。

### 1.2 产品目标
- **精确提取首位**：完整且原封不动地从PDF格式财报（含扫描版）中提取资产负债表、利润表和现金流量表，保留原表的全部布局、内容、行和列。
- **标准化数据落盘**：将精确提取的三大表输出为标准的 Excel 文件，且每张表独立存放在单独的 sheet 页中。
- **大模型静默驱动**：后台内置精调的提示词（Prompt）调用云端大模型能力，提示词对普通用户隐蔽但高阶用户可配。
- **单机离线安全体验**：提供轻量级的单机桌面端体验，彻底告别沉重的本地深度学习环境，支持用户自带密钥（BYOK）。

### 1.3 产品价值
- 提高财报分析效率，大幅度减少人工数据搬运时间。
- 采用大模型视觉与推理能力，极大降低扫描版与非标准排版财报的数据提取错误率。
- 标准化分析流程，让专业复杂的财务推演所见即所得。

### 1.4 适用范围
本产品适用于需要对企业财报进行高频次深度分析的财务人员、投资分析师、会计师事务所等专业人士。

## 2. 核心功能

### 2.1 功能模块
本产品基于“大模型瘦客户端架构”，包含以下核心功能模块：

1. **导入与解析台**：支持导入PDF格式的财报文件，完成本地图像切片预处理，并支持按页勾选精确剔除无关附件。
2. **大模型提取引擎**：依靠内置系统不可见 Prompt (System Prompt)，将图像丢给云端 VLM (视觉语言模型) 精确提取三大表。
3. **结构化处理与 Excel 导出**：将模型抽取的 JSON 组装为多 Sheet 的 Excel 格式并落盘。
4. **Agentic 报告推演**：根据用户导入的 Markdown 模板，以打字机流式输出报告。
5. **系统设置与安全中心**：API 密钥的本地加密存储、大模型供应商切换设定。

### 2.2 功能详情

#### 2.2.1 导入与设置模块
- **系统设置**：支持配置大模型 API Key（本地硬加密），可定义反向代理 Base URL 与指定具体模型 ID，内置网络连通性一键探测。
- **文件导入与筛选**：支持拖拽导入 PDF 文件，并对切片结果提供网格视图以便用户手工勾选要提取的核心表单页。
- **隐蔽的智能预设**：提取模块的底层 Prompt 经过精密设计与内置，确保无论任何财报版式，大模型都能理解“原封不动提取三表并保持行列对齐”的意图指令（该指令对普通用户不可见）。

#### 2.2.2 高精度数据提取模块
- **无视版式差异**：无论是标准数字版 PDF 还是盖章的扫描件 PDF，均按统一的多模态图像流处理机制工作。
- **绝对保真的结构**：要求大模型原封不动地识别提取资产负债表、现金流量表、利润表的每一个单元格，保留原版的行和列表头属性。
- **异步与进度闭环**：以显性化的状态机（例如：“正在提取资产负债表...”）展示进度，并标识 Token 预计消耗量，消除用户等待大模型响应的焦虑。

#### 2.2.3 多 Sheet Excel 存储模块
- 软件将大模型结构化之后的数据组装并导出为标准的 `.xlsx` 文件。
- Excel 文件中严格划分出三个独立的 Sheet 页：`资产负债表`、`利润表`、`现金流量表`。

#### 2.2.4 报告生成与导出模块
- 根据用户提供的 Markdown 格式的分析模板，将三表数据丢给大模型（LLM）进行逻辑推演。
- 界面展现报告生成的“思维过程”与流式的打字机效果。
- 允许将报告导出为 PDF 格式。

## 3. 核心流程

### 3.1 整体业务链路

1. **配置环境**：用户首次打开软件，进入左下角设置中心录入大模型 API Key。
2. **导入文件**：在导入台拖入 PDF 格式的财报文件。
3. **智能切片与提取**：软件在本地对 PDF 进行图像切割，并携带内置的 System Prompt 发送至云端大模型接口。
4. **原表重构与 Excel 生成**：大模型识别完毕，前端界面校验确认后，一键生成包含 3 个独立 Sheet 的 Excel 文件。
5. **(可选) 深度报告推演**：用户可选附加分析模板，大模型根据提取的精确数据，流式书写最终定性定量分析报告。

## 4. 用户界面设计

### 4.1 设计原则 (Minimalism & Glassmorphism)
- 全面拥抱现代软件设计（参考 UI/UX 方案文档），抛弃传统的阻断式对话框。
- 设计语言注重专业感（深色系/浅色系适配，严格的等宽数字字体）。

### 4.2 核心视窗布局
- **全局左侧边栏**：导航各项工作台，底部常驻 Token 消费预估与系统设置页。
- **提取校对双屏工作区**：左侧展示 PDF 切片原图，右侧对应渲染高保真的高亮电子表单，方便人工做极速比对（联动高亮功能）。
- **打字机报告推演区**：提供沉浸式的 Markdown 预览效果与执行态感知。

## 5. 技术方案概要

*(详见《财报分析离线桌面端架构演进(大模型版).md》与《财报分析桌面端大模型版_TDD开发计划.md》)*

- **纯前端展现与混合客户端**：采用 `Electron` + `React 18` + `Tailwind CSS`，安装包控制在 100MB 级别内。
- **底层驱动模式重构**：剥离本地沉重的 Python 分析与 OCR 引擎，使用原生的 Node.js 进程直连如 GPT-4o、Claude 3.5 Sonnet 等前端前沿大模型。
- **Excel 技术栈**：使用 `exceljs` 或纯前端的 `xlsx` 库在内存中高效构建包含多个独立 Sheet 的工作簿并落盘保存。
- **安全性封装**：核心密钥通过 `better-sqlite3` 与设备盐值在 Electron 主进程做本地最高级别加密，坚决不触网上传。

## 6. 核心数据结构与存储模式

### 6.1 精确提取的 JSON 中枢协议
每一次传递给 Excel 或是生成报告引擎的数据都需统一转化为多级 JSON。
```json
{
  "balance_sheet": { "rows": [...], "columns": [...] },
  "income_statement": { "rows": [...], "columns": [...] },
  "cash_flow_statement": { "rows": [...], "columns": [...] }
}
```

## 7. 验收标准

### 7.1 功能验收
- **精确提取保真度**：对于随机测试的 10 份复杂版式与扫描版财报，导出的 Excel 中，三大表的版式、行列分布必须完全对应 PDF 原图，错位率低于 1%。
- **Excel 多 Sheet**：导出的 Excel 文件必须确保只包含资产负债表、利润表、现金流量表这三个独立 Sheet，且内容可用作公式运算素材。
- **大模型流式调用**：内置的 Prompt 调用不能对用户暴露源码，且生成报告时必须有顺滑的流式输出（打字机）体验。
- **离线安全体验**：除直连大模型 API 外，不会产生针对任何非官方后台的网络抓包请求。

## 8. 演进路线

本 PRD 已经作为大模型敏捷瘦客户端版本的最终基线。后续开发需严格匹配架构文档和 TDD 测试驱动规范进行研发实施。